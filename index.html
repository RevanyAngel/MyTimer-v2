<!DOCTYPE html>
<html>
    <head>
        <title>Reee Timer</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Delius&family=Gaegu&family=VT323&display=swap" rel="stylesheet">
        <link href="style.css" rel="stylesheet">
        
    </head>

    <body>
        <section class="wrapper">
            <h1>Pomodoro</h1>
            <div id="tampilanWaktu">
                <span id="menit">25</span>:<span id="detik">00</span>
            </div>
            
            <div class="button-wrapper">
                <button id="btnMain" onclick="actionMainButton()">Start Work</button>
                
                <div class="secondary-buttons">
                    <button class="btn-small" onclick="timer_Rest()">Rest</button>
                    <button class="btn-small btn-reset" onclick="resetTimer()">Reset</button>
                </div>
            </div>
            <h3>Total Focus: <span id="totalWaktu">0</span> min</h3>
        </section>

        <script>
            // --- VARIABEL GLOBAL ---
            let elemenTampilan = document.getElementById("tampilanWaktu");
            let waktuMenit = document.getElementById("menit");
            let waktuDetik = document.getElementById("detik");
            let hitungMenit = document.getElementById("totalWaktu");
            let btnMain = document.getElementById("btnMain");

            let refTampilan = null;
            let beepBerulang = null;
            
            // Variabel Penyimpanan Total Waktu (Akumulasi)
            let totalMenitFokus = 0; 
            
            // Variabel Logika
            let targetWaktu = 0;
            let sisaWaktuSimpan = 0;
            let pesanGlobal = "";
            let isPaused = false;
            let isRunning = false; 
            let isRinging = false; 
            let currentMode = "WORK"; 

            // --- AUDIO CONTEXT ---
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            if(Notification.permission !== "granted"){
                Notification.requestPermission();
            }

            function beep(){
                if (audioCtx.state === 'suspended') audioCtx.resume();
                let oscillator = audioCtx.createOscillator();
                let gainNode = audioCtx.createGain();
                oscillator.type = "sine";
                oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            }

            // --- LOGIKA TOMBOL UTAMA ---
            function actionMainButton() {
                if (isRinging) {
                    resetTimer(); // Matikan suara
                    return;
                }
                if (!isRunning && !isPaused) {
                    timer_Work(); 
                } else if (isRunning) {
                    togglePause();
                } else if (isPaused) {
                    togglePause();
                }
            }

            // Fungsi untuk Mengubah Teks Tombol Sesuai Status
            function updateButtonUI() {
                if (isRinging) {
                    btnMain.textContent = "STOP ALARM";
                    btnMain.style.backgroundColor = "#ff6b6b"; 
                    btnMain.style.color = "#fff";
                } else if (isRunning) {
                    btnMain.textContent = "Pause";
                    btnMain.style.backgroundColor = "#ffcad4"; 
                    btnMain.style.color = "#5e503f";
                } else if (isPaused) {
                    btnMain.textContent = "Resume";
                    btnMain.style.backgroundColor = "#ffe599"; 
                    btnMain.style.color = "#5e503f";
                } else {
                    // Posisi Reset / Awal (Warna Biru sesuai CSS)
                    btnMain.textContent = "Start Work";
                    btnMain.style.backgroundColor = "#cae9ff"; 
                    btnMain.style.color = "#5e503f";
                }
            }

            // --- LOGIKA TIMER ---
            function updateTampilan(){
                const sisaWaktuMs = targetWaktu - Date.now();
                sisaWaktuSimpan = sisaWaktuMs;

                if(sisaWaktuMs <= 0){
                    finishTimer();
                    return; 
                }

                const sisaMenit = Math.floor(sisaWaktuMs / 60000);
                const sisaDetik = Math.floor((sisaWaktuMs % 60000) / 1000);

                waktuMenit.textContent = (sisaMenit < 10 ? "0" : "") + sisaMenit;
                waktuDetik.textContent = (sisaDetik < 10 ? "0" : "") + sisaDetik;
            }

            function finishTimer() {
                stopTimer(); 
                
                waktuMenit.textContent = "00";
                waktuDetik.textContent = "00";
                
                isRunning = false;
                isPaused = false;
                isRinging = true; 

                // LOGIKA BARU: Tambah Total Focus hanya jika timer WORK selesai
                if(currentMode === "WORK") {
                    totalMenitFokus += 25; // Tambah 25 menit
                    hitungMenit.textContent = totalMenitFokus; // Tampilkan
                }

                if(Notification.permission === "granted"){
                    new Notification("Time is Up!", { body: pesanGlobal });
                }

                beep(); 
                beepBerulang = setInterval(beep, 1000);
                
                updateButtonUI(); 
            }

            function mulaiTimer(menit, detik, pesan, mode){
                stopTimer(); 
                
                if (audioCtx.state === 'suspended') audioCtx.resume();

                elemenTampilan.innerHTML = `<span id="menit"></span>:<span id="detik"></span>`;
                waktuMenit = document.getElementById("menit");
                waktuDetik = document.getElementById("detik");  
                
                pesanGlobal = pesan;
                currentMode = mode;
                sisaWaktuSimpan = (menit * 60 * 1000) + (detik * 1000) + 999;
                
                isRunning = true;
                isPaused = false;
                isRinging = false; 
                
                jalankanInterval();
                updateButtonUI(); 
            }

            function jalankanInterval(){
                targetWaktu = Date.now() + sisaWaktuSimpan;
                updateTampilan();
                refTampilan = setInterval(updateTampilan, 1000);
            }

            function togglePause(){
                if(!isRunning && !isPaused) return; 

                if(isPaused){
                    isPaused = false;
                    isRunning = true;
                    jalankanInterval();
                } else {
                    isPaused = true;
                    isRunning = false;
                    if(refTampilan) clearInterval(refTampilan);
                    refTampilan = null;
                }
                updateButtonUI(); 
            }

            function stopTimer(){
                if(refTampilan) clearInterval(refTampilan);
                if(beepBerulang) clearInterval(beepBerulang);
                refTampilan = null;
                beepBerulang = null;
            }

            function resetTimer(){
                stopTimer(); 
                isRunning = false;
                isPaused = false;
                isRinging = false; 
                
                waktuMenit.textContent = "25";
                waktuDetik.textContent = "00";
                
                // CATATAN PENTING:
                // Variabel totalMenitFokus TIDAK di-reset menjadi 0 di sini.
                // Jadi angka total focus akan tetap ada.
                
                updateButtonUI();
            }

            // --- FUNGSI PRESET ---
            function timer_Work(){
                mulaiTimer(25, 0, "Time to rest!", "WORK");
            }

            function timer_Rest(){
                mulaiTimer(5, 0, "Back to work!", "REST");
            }
        </script>
    </body>
</html>